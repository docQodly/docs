"use strict";(self.webpackChunkqodly=self.webpackChunkqodly||[]).push([[6342],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?a.createElement(k,o(o({ref:t},c),{},{components:n})):a.createElement(k,o({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},13067:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const i={id:"$atomic$atOnce",title:"$atomic/$atOnce"},o=void 0,l={unversionedId:"api/$atomic$atOnce",id:"api/$atomic$atOnce",title:"$atomic/$atOnce",description:"Functionality",source:"@site/docs/api/$atomic$atOnce.md",sourceDirName:"api",slug:"/api/$atomic$atOnce",permalink:"/docs/api/$atomic$atOnce",draft:!1,editUrl:"https://github.com/docQodly/docs/edit/main/docs/api/$atomic$atOnce.md",tags:[],version:"current",frontMatter:{id:"$atomic$atOnce",title:"$atomic/$atOnce"},sidebar:"API",previous:{title:"$asArray",permalink:"/docs/api/$asArray"},next:{title:"$attributes",permalink:"/docs/api/$attributes"}},s={},p=[{value:"Functionality",id:"functionality",level:2},{value:"Definition",id:"definition",level:3},{value:"Syntax",id:"syntax",level:3},{value:"Combining with Other Query Parameters",id:"combining-with-other-query-parameters",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Updating Multiple Records",id:"updating-multiple-records",level:3},{value:"Inserting Multiple Records",id:"inserting-multiple-records",level:3},{value:"Deleting Multiple Records",id:"deleting-multiple-records",level:3},{value:"Best Practices",id:"best-practices",level:2}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"functionality"},"Functionality"),(0,r.kt)("h3",{id:"definition"},"Definition"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"$atomic")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"$atOnce")," endpoints allow you to execute multiple actions in a single REST request within a transaction. If any action fails, the entire transaction is canceled, ensuring data consistency and integrity."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"This is crucial for maintaining data integrity, especially when dealing with operations that must be executed as a unit.")),(0,r.kt)("h3",{id:"syntax"},"Syntax"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /rest/{{dataClass}}?$atomic=true\n")),(0,r.kt)("p",null,"or"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /rest/{{dataClass}}?$atOnce=true\n")),(0,r.kt)("h2",{id:"combining-with-other-query-parameters"},"Combining with Other Query Parameters"),(0,r.kt)("p",null,"You can combine ",(0,r.kt)("inlineCode",{parentName:"p"},"$atomic")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"$atOnce")," with other query parameters to refine your data manipulation operations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Filtering:")," Ensure that filtered data updates are transactional."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"POST /rest/Users?$atomic=true&$filter=\"department='HR'\"\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Sorting:")," Maintain transactional integrity while sorting data."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'POST /rest/Users?$atOnce=true&$orderby="lastName desc"\n')))),(0,r.kt)("h2",{id:"use-cases"},"Use Cases"),(0,r.kt)("h3",{id:"updating-multiple-records"},"Updating Multiple Records"),(0,r.kt)("p",null,"Updating multiple records atomically to ensure all or none of the changes are applied:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Request:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /rest/Users?$atomic=true\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"POST data:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "__KEY": "1",\n        "Name": "John"\n    },\n    {\n        "__KEY": "2",\n        "Name": "Jane"\n    }\n]\n')),(0,r.kt)("p",null,"If any record update fails, neither record is updated."),(0,r.kt)("admonition",{title:"Partial Success Scenario",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In a scenario where one of the entities in the transaction fails, the entire transaction is canceled, and no changes are saved. If an error occurs for the user with '__KEY: 222', the response would indicate that the transaction failed:"),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"POST data"),":"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "__KEY": "1",\n        "Name": "John"\n    },\n    {\n        "__KEY": "222",\n        "Name": "Jane"\n    }\n]\n')),(0,r.kt)("p",{parentName:"admonition"},"If there is an error in one of the entities, the entire transaction is canceled, and no changes are saved. For example, if the second entity has an error:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "__STATUS": {\n        "success": true\n    },\n    "__KEY": "1",\n    "__STAMP": 4,\n    "uri": "/rest/Users[1]",\n    "__TIMESTAMP": "!!2024-05-20!!",\n    "ID": 1,\n    "Name": "John",\n    "Email": "user1@example.com",\n    "Orders": {\n        "__deferred": {\n            "uri": "/rest/Users[1]/Orders?$expand=Orders"\n        }\n    },\n    "profilePicture": {\n        "__deferred": {\n            "uri": "/rest/Users[1]/profilePicture?$binary=true&$version=4&$expand=profilePicture"\n        }\n    },\n    "__ERROR": [\n        {\n            "message": "Error code: 1542 (dbmg)\\nCannot find entity with \\"222\\" key in the \\"Users\\" dataclass\\nDatabase Engine\\nDatabase Engine\\ntask 48, name: \'REST Handler: \'\\n",\n            "componentSignature": "dbmg",\n            "errCode": 1542\n        }\n    ]\n}\n')),(0,r.kt)("p",{parentName:"admonition"},"Even though the first entity has valid data, it is not saved due to the error in the second entity. If you reload the first entity, you will see the previous values, confirming that no changes were made.")),(0,r.kt)("h3",{id:"inserting-multiple-records"},"Inserting Multiple Records"),(0,r.kt)("p",null,"Inserting multiple records in a single transaction:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Request:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /rest/Users?$method=insert&$atOnce=true\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"POST data:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "firstname": "Alice",\n        "lastname": "Brown"\n    },\n    {\n        "firstname": "Bob",\n        "lastname": "White"\n    }\n]\n')),(0,r.kt)("p",null,"Both records are inserted only if both operations succeed."),(0,r.kt)("h3",{id:"deleting-multiple-records"},"Deleting Multiple Records"),(0,r.kt)("p",null,"Deleting multiple records within a transaction:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Request:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /rest/Users?$method=delete&$atomic=true\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"POST data:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "__KEY": "200"\n    },\n    {\n        "__KEY": "201"\n    }\n]\n')),(0,r.kt)("p",null,"Both records are deleted only if both deletions succeed."),(0,r.kt)("h2",{id:"best-practices"},"Best Practices"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Use Only When Necessary:")," Employ ",(0,r.kt)("inlineCode",{parentName:"p"},"$atomic")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"$atOnce")," only for operations that require strict transactional integrity.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Minimize Transaction Scope:")," Limit the scope of transactions to essential actions to reduce the potential for conflicts and errors.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Combine with Other Parameters:")," Leverage other query parameters (",(0,r.kt)("inlineCode",{parentName:"p"},"$filter"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"$orderby"),") to optimize data manipulation and performance."))))}d.isMDXComponent=!0}}]);