"use strict";(self.webpackChunkqodly=self.webpackChunkqodly||[]).push([["57467"],{3644:function(e,n,i){i.r(n),i.d(n,{metadata:()=>s,contentTitle:()=>o,default:()=>a,assets:()=>c,toc:()=>d,frontMatter:()=>l});var s=JSON.parse('{"id":"api/$lock","title":"$lock","description":"Functionality","source":"@site/versioned_docs/version-1.1.0/api/$lock.md","sourceDirName":"api","slug":"/api/$lock","permalink":"/docs/api/$lock","draft":false,"unlisted":false,"editUrl":"https://github.com/qodly/docs/issues/new?title=Comment%20on%20api%2F%24lock.md%20(1.1.0)&body=Share%20any%20feedback%20about%20this%20page%20%E2%80%94%20report%20issues%2C%20suggest%20improvements%2C%20or%20tell%20us%20what%E2%80%99s%20helpful.%0A%0AIf%20it%E2%80%99s%20an%20issue%3A%0A-%20What%E2%80%99s%20the%20issue%3F%20(e.g.%2C%20typo%2C%20incorrect%20information%2C%20unclear%20explanation)%0A-%20Where%20is%20it%3F%20(e.g.%2C%20section%20name%2C%20specific%20paragraph%2C%20or%20line)%0A%0AThank%20you%20for%20helping%20us%20improve!%20%F0%9F%9A%80%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20","tags":[],"version":"1.1.0","frontMatter":{"id":"$lock","title":"$lock"},"sidebar":"Integrations","previous":{"title":"$imageformat","permalink":"/docs/api/$imageformat"},"next":{"title":"$method","permalink":"/docs/api/$method"}}'),t=i("85893"),r=i("50065");let l={id:"$lock",title:"$lock"},o=void 0,c={},d=[{value:"Functionality",id:"functionality",level:2},{value:"Definition",id:"definition",level:3},{value:"Locking an Entity",id:"locking-an-entity",level:3},{value:"Unlocking an Entity",id:"unlocking-an-entity",level:3},{value:"Locking Mechanics",id:"locking-mechanics",level:2},{value:"Error Codes",id:"error-codes",level:2},{value:"Lock Information",id:"lock-information",level:2},{value:"Common Properties",id:"common-properties",level:3},{value:"REST Session Lock Properties",id:"rest-session-lock-properties",level:3},{value:"Combining with Other Parameters",id:"combining-with-other-parameters",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Locking an Entity",id:"locking-an-entity-1",level:3},{value:"Attempting to Lock an Already Locked Entity",id:"attempting-to-lock-an-already-locked-entity",level:3},{value:"Unlocking an Entity",id:"unlocking-an-entity-1",level:3},{value:"Best Practices",id:"best-practices",level:2}];function h(e){let n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"functionality",children:"Functionality"}),"\n",(0,t.jsx)(n.h3,{id:"definition",children:"Definition"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"$lock"})," endpoint allows you to lock and unlock an entity using a pessimistic locking mechanism. This ensures that the entity cannot be modified by other sessions while it is locked."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"Locks triggered by the REST API are applied at the session level."})}),"\n",(0,t.jsx)(n.h3,{id:"locking-an-entity",children:"Locking an Entity"}),"\n",(0,t.jsx)(n.p,{children:"To lock an entity for other sessions, use the following syntax:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /rest/{{dataClass}}({{id}})?$lock=true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"unlocking-an-entity",children:"Unlocking an Entity"}),"\n",(0,t.jsx)(n.p,{children:"To unlock an entity for other sessions, use the following syntax:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /rest/{{dataClass}}({{id}})?$lock=false\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.code,{children:"?$lock"})," request returns a JSON object with a ",(0,t.jsx)(n.code,{children:'"result"'})," field indicating the success of the lock operation. The ",(0,t.jsx)(n.code,{children:"__STATUS"})," object provides additional details."]})}),"\n",(0,t.jsx)(n.h2,{id:"locking-mechanics",children:"Locking Mechanics"}),"\n",(0,t.jsx)(n.p,{children:"When an entity is locked, the following actions are not possible for other sessions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Locking"}),"\n",(0,t.jsx)(n.li,{children:"Unlocking"}),"\n",(0,t.jsx)(n.li,{children:"Updating"}),"\n",(0,t.jsx)(n.li,{children:"Deleting"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"An entity locked by the REST API can only be unlocked by:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The same session that locked it, using ",(0,t.jsx)(n.code,{children:"?$lock=false"})]}),"\n",(0,t.jsx)(n.li,{children:"Reaching the session's inactivity timeout, which closes the session"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"error-codes",children:"Error Codes"}),"\n",(0,t.jsxs)(n.p,{children:["The following error codes and messages may be returned in the ",(0,t.jsx)(n.code,{children:"__STATUS"})," object in case of an error:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Status"}),(0,t.jsx)(n.th,{children:"StatusText"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:'"Stamp has changed"'}),(0,t.jsx)(n.td,{children:"The internal stamp value of the entity does not match the stored entity."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:'"Already locked"'}),(0,t.jsx)(n.td,{children:"The entity is already locked by a pessimistic lock."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"4"}),(0,t.jsx)(n.td,{children:'"Other error"'}),(0,t.jsx)(n.td,{children:"A serious error, such as a low-level database error or a hardware error."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5"}),(0,t.jsx)(n.td,{children:'"Entity does not exist"'}),(0,t.jsx)(n.td,{children:"The entity no longer exists in the database."})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"lock-information",children:"Lock Information"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"__STATUS"})," object may include additional properties providing information about the lock:"]}),"\n",(0,t.jsx)(n.h3,{id:"common-properties",children:"Common Properties"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"success"}),(0,t.jsx)(n.td,{children:"boolean"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"true"})," if the lock action is successful, otherwise ",(0,t.jsx)(n.code,{children:"false"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"status"}),(0,t.jsx)(n.td,{children:"number"}),(0,t.jsx)(n.td,{children:"Error code (available only in case of error)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"statusText"}),(0,t.jsx)(n.td,{children:"text"}),(0,t.jsx)(n.td,{children:"Description of the error (available only in case of error)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"lockKind"}),(0,t.jsx)(n.td,{children:"number"}),(0,t.jsx)(n.td,{children:"Lock code."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"lockKindText"}),(0,t.jsx)(n.td,{children:"text"}),(0,t.jsx)(n.td,{children:'Description of the lock type ("Locked by session" or "Locked by record").'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"lockInfo"}),(0,t.jsx)(n.td,{children:"object"}),(0,t.jsx)(n.td,{children:"Information about the lock origin."})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"rest-session-lock-properties",children:"REST Session Lock Properties"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"host"}),(0,t.jsx)(n.td,{children:"text"}),(0,t.jsx)(n.td,{children:"URL that locked the entity."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"IPAddr"}),(0,t.jsx)(n.td,{children:"text"}),(0,t.jsx)(n.td,{children:"IP address of the locker."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"recordNumber"}),(0,t.jsx)(n.td,{children:"number"}),(0,t.jsx)(n.td,{children:"Record number of the locked record."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"userAgent"}),(0,t.jsx)(n.td,{children:"text"}),(0,t.jsx)(n.td,{children:"User agent of the locker."})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"combining-with-other-parameters",children:"Combining with Other Parameters"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"$lock"})," parameter can be combined with other parameters to control and manage entity locking effectively:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$filter"}),": Apply filters to select specific entities before locking them."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$expand"}),": Include related data in the response when locking an entity."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$attributes"}),": Specify which attributes to include in the response when an entity is locked."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$version"}),": Ensure the correct version of the entity is locked by specifying the version number."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$top/$limit"})," and ",(0,t.jsx)(n.strong,{children:"$skip"}),": Limit the number of entities and skip a certain number of entities before locking."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$method=entityset"}),": Create an entity set and lock the entities within that set."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$compute"}),": Perform calculations on related data before locking entities based on the computed results."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"$orderby"}),": Sort entities before applying the lock to ensure specific ordering criteria."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsx)(n.h3,{id:"locking-an-entity-1",children:"Locking an Entity"}),"\n",(0,t.jsx)(n.p,{children:"Lock an entity in a first browser session:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /rest/Customers(1)?$lock=true\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "result": true,\n    "__STATUS": {\n        "success": true\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"attempting-to-lock-an-already-locked-entity",children:"Attempting to Lock an Already Locked Entity"}),"\n",(0,t.jsx)(n.p,{children:"Attempt to lock the same entity in a second browser session:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /rest/Customers(1)?$lock=true\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "result": false,\n    "__STATUS": {\n        "status": 3,\n        "statusText": "Already locked",\n        "lockKind": 7,\n        "lockKindText": "Locked by session",\n        "lockInfo": {\n            "host": "127.0.0.1:8043",\n            "IPAddr": "127.0.0.1",\n            "recordNumber": 7,\n            "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36..."\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"unlocking-an-entity-1",children:"Unlocking an Entity"}),"\n",(0,t.jsx)(n.p,{children:"Unlock the entity in the same session that locked it:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /rest/Customers(1)?$lock=false\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "result": true,\n    "__STATUS": {\n        "success": true\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Lock Only When Necessary:"})," Use locking sparingly to avoid performance bottlenecks and ensure that entities are available for other sessions."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Monitor Lock Status:"})," Regularly check the lock status and handle errors gracefully to maintain smooth application performance."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Session Management:"})," Ensure proper session management to avoid unintended locking due to session timeouts."]}),"\n"]}),"\n"]})]})}function a(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},50065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return l}});var s=i(67294);let t={},r=s.createContext(t);function l(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);